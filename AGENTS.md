# AGENTS.md

This file provides instructions for AI coding agents working with this dotfiles repository.

## Project Overview

This is a personal dotfiles repository for **leocavalcante** (Leo Cavalcante) containing development environment configurations. The repository uses **GNU Stow** to manage symlinks and includes shell configurations, git settings, editor configs, and custom AI-powered developer tools.

## Project Structure

```
.
├── .alacritty.toml          # Alacritty terminal emulator config
├── .config/                 # Application configs
│   ├── kitty/              # Kitty terminal config
│   ├── nvim/               # Neovim editor config
│   └── starship.toml       # Starship prompt config
├── .emacs.d/               # Emacs editor config
├── .gemini/                # Gemini AI config
├── .gitconfig              # Git configuration
├── .tmux.conf              # Tmux terminal multiplexer config
├── .zshrc                  # Zsh shell configuration (main file)
├── ghc.sh                  # GitHub Copilot CLI wrappers (ghcs, ghce)
├── vibe.sh                 # AI-powered code assistant tool
└── README.md               # User-facing documentation
```

## Setup and Installation

**Prerequisites:**
- GNU Stow must be installed
- Zsh shell
- Git

**Install dotfiles:**
```bash
cd ~/.dotfiles
stow .
```

This creates symlinks from the repository to `$HOME`.

## Key Tools and Functions

### Custom Shell Functions (defined in .zshrc)

1. **dot()** - Update dotfiles from repository
   - Pulls latest changes
   - Re-stows files
   
2. **commit()** - AI-generated git commit messages
   - Uses ChatGPT to generate commit messages from staged changes
   - Requires `chatgpt` CLI tool

3. **pr()** - AI-generated pull requests
   - Creates GitHub PR with AI-generated title and body
   - Uses `chatgpt` and `gh` CLI tools

4. **cld()** - Quick Claude AI access
   - Wrapper for Claude CLI with write/edit/bash tools enabled

5. **up()** - System update utility
   - Updates apt packages (Linux) and Homebrew

6. **vibe()** - AI-powered code assistant (from vibe.sh)
   - Modifies files based on natural language instructions
   - Can answer questions in terminal
   - Supports `--backup`, `--push`, `--pr` flags

### GitHub Copilot Wrappers (ghc.sh)

- **ghcs()** - GitHub Copilot suggest (shell/git/gh commands)
- **ghce()** - GitHub Copilot explain commands

### Important Aliases

```bash
gpt         # chatgpt CLI
l, ls, ll   # eza (modern ls replacement)
v           # vibe
cl          # clear
stk         # starship toggle kubernetes
python      # python3
pip         # pip3
push        # git push
```

## Environment Variables

- `EDITOR`, `GIT_EDITOR`, `KUBE_EDITOR`, `SUDO_EDITOR` → `nvim`
- `COMPOSE_BAKE=true`
- `LANG=en_US.UTF-8`
- PHP Composer paths configured
- Go paths configured (if Go installed)

## Agent Boundaries

**DO NOT:**
- Modify `.git/` directory
- Change file permissions or ownership
- Remove or modify existing working configurations without explicit user request
- Commit secrets or sensitive data
- Modify binary files in `.emacs.d/` or other config directories without understanding their purpose

**DO:**
- Keep modifications minimal and surgical
- Preserve existing formatting and structure
- Test commands before suggesting them
- Respect the user's existing tool choices (nvim, zsh, etc.)

## Dependencies

Required CLI tools:
- `chatgpt` - https://github.com/kardolus/chatgpt-cli
- `gh` - GitHub CLI
- `stow` - GNU Stow
- `eza` - Modern ls replacement
- `zoxide` - Smart directory jumper
- `starship` - Cross-shell prompt
- `delta` - Git diff pager
- `nvim` - Neovim editor

Optional tools:
- `tmux` - Terminal multiplexer
- `claude` - Claude CLI
- `go` - Go programming language

## Coding Style

**Shell scripts:**
- Use bash or zsh syntax as appropriate
- Follow existing indentation (2 spaces)
- Use descriptive variable names
- Add comments only for complex logic
- Use `local` for function variables

**Configuration files:**
- Preserve existing format and style
- Keep comments intact
- Test changes before committing

## Git Workflow

1. Changes should be staged before using `commit()` function
2. Commit messages are generated by AI (chatgpt)
3. Use `push` alias or `--push` flag for pushing
4. Pull requests created via `pr()` or `--pr` flag

**Note:** Auto-setup remote is enabled (`push.autoSetupRemote = true`)

## Special Notes

- **vibe.sh** was generated using the Vibe Coding process - only modify for prompt improvements or critical fixes
- **Antigen plugin manager**: The repository uses Antigen for Zsh plugin management (auto-installed on first run). Do NOT recommend replacing it with alternatives like zinit, sheldon, etc. - this is a deliberate choice by the user. Antigen's startup overhead is acceptable for the simplicity and stability it provides.
- Symlinks are managed by GNU Stow - use `stow .` to apply changes
- Local git config can be added to `~/.gitconfig.local` (included automatically)

## Recent Improvements (Jan 14, 2026)

### .zshrc Refactoring & Performance Optimizations

All improvements completed with the following enhancements:

1. **Removed Anthropic helper functions** - Eliminated `_set_anthropic_vars()` and `_unset_anthropic_vars()` functions; rewritten `enable_copilot_api()`, `disable_copilot_api()`, `enable_bedrock()`, and `disable_bedrock()` with inline variable assignments for clarity and maintainability.

2. **Consolidated Go checks** - Merged duplicate Go version checks (lines 27-30 and 40-42) into a single block that exports both `GOPATH`/`GOBIN` variables AND adds to PATH simultaneously.

3. **Simplified composer() function** - Streamlined with `emulate -L zsh` for robustness; kept auto-loading of `auth.json` on demand.

4. **Simplified up() function** - Removed empty `Darwin` case; now uses clean if statement checking OS type. Added `emulate -L zsh`.

5. **Cached tool initialization** - Added smart caching for `starship` and `zoxide` initialization with auto-invalidation when tool binaries are updated. Cache stored in `~/.cache/zsh/`.

6. **Conditional Bun path** - Changed from unconditional path addition to existence check: `[[ -d "$HOME/.bun/bin" ]] && path+=("$HOME/.bun/bin")`

7. **Enhanced history options** - Added `HIST_FIND_NO_DUPS` (prevents duplicates in history search) and `INC_APPEND_HISTORY` (writes commands immediately to history file).

8. **Added explicit compinit** - Proper completion system initialization with `autoload -Uz compinit` for robustness.

9. **Added emulate -L zsh** - Added to all custom functions (`dot()`, `up()`, `composer()`, and Anthropic functions) for consistent zsh behavior regardless of user options.

10. **Removed emoji decorations** - Cleaned up status messages in functions for cleaner terminal output.

**Result:** Reduced file from 253 to 248 lines, improved startup performance via caching, and increased code clarity and maintainability.

## Recent Improvements (Jan 14, 2026 - Round 2)

### .zshrc Performance & Robustness Enhancements

Additional optimizations implemented:

1. **Added APPEND_HISTORY setopt** - New history option that ensures history entries are appended atomically, improving reliability in multi-terminal sessions and preventing history loss during terminal crashes.

2. **Simplified composer() redundancy** - Removed unnecessary conditional check inside `composer()` function (lines 162-163) since `COMPOSER_AUTH` is already loaded on startup (lines 168-170), reducing unnecessary file I/O and logic branches during command execution.

3. **Fixed compinit portability** - Replaced `/usr/share/zsh` existence check (which doesn't exist on macOS) with Zsh's built-in `(#qN.mh+24)` glob qualifier that checks if `.zcompdump` is older than 24 hours. This is portable across all platforms (Linux/macOS) and more reliable.

4. **Enhanced starship cache invalidation** - Added version hash detection alongside binary modification time check. Now creates `~/.cache/zsh/starship.hash` to track starship version; if version changes, cache is automatically regenerated. Catches updates where binary timestamp remains unchanged (e.g., reinstalls).

5. **Lazy-loaded zoxide initialization** - Replaced caching approach with true lazy-loading pattern. Zoxide's `z` and `zi` functions are now defined as stubs that initialize zoxide on first use, then call the actual function. Avoids startup cost entirely if zoxide is never used; previously always sourced initialization at shell startup.

**Result:** Reduced startup overhead further, improved cross-platform compatibility, enhanced robustness of tool initialization, and eliminated redundant operations.

## Recent Improvements (Jan 14, 2026 - Round 3)

### .zshrc Startup Performance Optimizations

Quick wins for reducing shell startup time without major refactoring:

1. **Replaced `command -v` with `(( $+commands[...] ))`** - Changed 7 startup checks from subprocess calls to hash table lookups. Hash lookups are significantly faster than spawning external processes. Affected checks: `go`, `stow`, `brew`, `zoxide`, `starship`, `goose`, `opencode`.

2. **Removed starship `--version` subprocess** - Eliminated unnecessary `starship --version` call that spawned a subprocess on every startup. Now relies only on binary modification time for cache invalidation, which is sufficient for detecting updates.

3. **Lazy-loaded COMPOSER_AUTH** - Moved `auth.json` loading from startup into the `composer()` function. Only loads when composer is actually invoked, not on every shell startup.

4. **Simplified starship cache logic** - Removed version hash tracking file (`starship.hash`), reducing filesystem operations. Binary modification time check is sufficient for cache invalidation.

**Result:** Estimated 30-80ms faster shell startup through reduced subprocesses and file I/O operations.

## Testing Changes

After modifying configuration files:

1. For shell configs: `source ~/.zshrc` or restart terminal
2. For git config: Test with `git config --list`
3. For stow changes: `cd ~/.dotfiles && stow --restow .`

## Security

- Never commit API keys or tokens
- `~/.gitconfig.local` is for sensitive user-specific settings
- Composer auth is loaded from `~/.config/composer/auth.json`
- Be cautious with shell functions that execute AI-generated content

## Owner Information

- **Owner:** leocavalcante (Leo Cavalcante)
- **Purpose:** Personal development environment
- **Primary shell:** Zsh
- **Primary editor:** Neovim

## Additional Context

This is a personal, opinionated setup focused on:
- AI-assisted development workflows
- Terminal-based tools and editors
- Git workflow automation
- Cross-platform compatibility (Linux/macOS with Homebrew)
